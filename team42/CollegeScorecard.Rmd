---
title: "CollegeScorecard"
output: html_document
---

```{r}
require("doBy")
source("funcs.R")
library("tidyr")
#make a symlink from the data dir in the directory where this file is to the desired data file
datafile <- "data/merged.csv"
```


```{r, cache=TRUE}
college.df <- read.csv(datafile, header = TRUE, na.strings = c("NULL"))
```

#### NA

What is the ratio of NAs to non-NAs overall? (Note that NA includes only "Null" - not "PrivacySuppressed".)
```{r, cache=TRUE}
na.columns <- is.na(college.df)
not.na.columns <- !is.na(college.df)

sum(na.columns)/sum(not.na.columns)
```

Roughly 75%. 

Which column has the most NAs, and how many are there?

```{r}
col.na.ratios <- colSums(na.columns)/colSums(not.na.columns)
col.max.na <- c(max(col.na.ratios), nrow(college.df), which.max(col.na.ratios))
names(col.max.na) <- c("number of NAs", "number of rows", "column name")

col.max.na
```

So the NAs compose .05% of the rows in this column. Not terrible.

Which has the fewest NAs?

```{r}
col.min.na <- c(min(col.na.ratios), nrow(college.df), which.min(col.na.ratios))
names(col.min.na) <- c("number of NAs", "number of rows", "column name")

col.min.na
```

There are columns with no NAs at all. How many?

```{r}
length(college.df[,col.na.ratios == 0])
```


#### PrivacySuppressed

Now let's look at columns containing "PrivacySuppressed". (Note that this just counts from the set of columns that do not contain NA.)

```{r, cache = TRUE}
priv.supp.columns <- which(college.df == "PrivacySuppressed")
not.priv.supp.columns <- which(college.df != "PrivacySuppressed")

priv.supp.count <- length(priv.supp.columns)
not.priv.supp.count <- length(not.priv.supp.columns)
```

Note that this just counts the columns that do not contain NA. 

Here is the ratio of columns containing "privacy suppressed" to those without:

```{r}
priv.supp.count/not.priv.supp.count
```

About 50%. Which column has the most "privacy suppressed" entries?

```{r}
col.ps.ratios <- colSums(priv.supp.columns)/colSums(not.priv.supp.columns)
col.max.ps <- c(max(col.ps.ratios), nrow(college.df), which.max(col.ps.ratios))
names(col.max.ps) <- c("number of NAs", "number of rows", "column name")

col.max.ps
```


#### Looking forward.... this code is remarkably rough.

```{r}
head(
  summaryBy(
    FEMALE_COMP_ORIG_YR4_RT + FEMALE_COMP_ORIG_YR3_RT + FEMALE_COMP_ORIG_YR2_RT + FEMALE_COMP_ORIG_YR6_RT + FEMALE_COMP_ORIG_YR8_RT ~ region + PREDDEG, 
    data=college.df,
    FUN=function(x) {c(m =mean(x, na.rm = TRUE),s =sd(x, na.rm = TRUE)) }
    )
)
```

```{r}
names(college.df) <- rename_by_yaml(college.df,"data/data_dictionary.yaml")
kvs <- gather(college.df)
```
